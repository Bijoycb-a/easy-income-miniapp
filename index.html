
<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Easy Income</title>

<!-- Telegram Mini App SDK -->
<script src="https://telegram.org/js/telegram-web-app.js"></script>

<script type="module">
/* ==============================
   Firebase SDK (Module version)
   ============================== */
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
import { getFirestore, doc, setDoc, getDoc } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

/* ==============================
   Firebase Configuration (YOUR REAL CONFIG)
   ============================== */
const firebaseConfig = {
  apiKey: "AIzaSyCmz171rISksL7427FrD86lfjkEi6E4UsU",
  authDomain: "easy-income-web.firebaseapp.com",
  projectId: "easy-income-web",
  storageBucket: "easy-income-web.firebasestorage.app",
  messagingSenderId: "493006242840",
  appId: "1:493006242840:web:caee3a538236ad87282f6d"
};

/* ==============================
   Initialize Firebase
   ============================== */
const app = initializeApp(firebaseConfig);
const db = getFirestore(app);

/* ==============================
   Telegram Login (REAL & SECURE)
   ============================== */
const tg = Telegram.WebApp;
tg.ready();

const user = tg.initDataUnsafe.user;

if (!user) {
  document.body.innerHTML = "<h3>❌ Telegram user not detected</h3>";
} else {

  const uid = user.id.toString();
  const name = user.first_name;

  const userRef = doc(db, "users", uid);
  const snap = await getDoc(userRef);

  // Create user if not exists
  if (!snap.exists()) {
    await setDoc(userRef, {
      telegram_id: uid,
      name: name,
      balance: 0,
      total_earned: 0,
      referral: 0,
      blocked: false,
      created_at: new Date()
    });
  }

  // UI
  document.body.innerHTML = `
    <h2>✅ Welcome, ${name}</h2>
    <p>Your account is secured with Telegram ID</p>
    <p>Status: <b>REAL SYSTEM CONNECTED</b></p>
  `;
}
</script>
</head>

<body>
<h3>Loading Easy Income...</h3>
</body>
</html>
